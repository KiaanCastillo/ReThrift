// On screen button
var imgBtn = document.createElement("img");
var iconBase64 = "data:image/svg+xml;charset=utf-8;base64,PHN2ZyB3aWR0aD0iODAiIGhlaWdodD0iOTYiIHZpZXdCb3g9IjAgMCA4MCA5NiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPGcgZmlsdGVyPSJ1cmwoI2ZpbHRlcjBfZF8yXzIwKSI+CjxwYXRoIGQ9Ik0xNiAyMEMxNiAxMy4zNzI2IDIxLjM3MjYgOCAyOCA4SDgwVjcySDI4QzIxLjM3MjYgNzIgMTYgNjYuNjI3NCAxNiA2MFYyMFoiIGZpbGw9InVybCgjcGFpbnQwX3JhZGlhbF8yXzIwKSIvPgo8ZyBmaWx0ZXI9InVybCgjZmlsdGVyMV9kaV8yXzIwKSI+CjxwYXRoIGQ9Ik02NS4yMSAzMC43NDI1TDYwLjI1NzUgMjUuNzlDNTkuMjczOSAyNC44MDUyIDU3LjkzOTQgMjQuMjUxMiA1Ni41NDc1IDI0LjI1SDQ1LjQ1MjVDNDQuMDYwNiAyNC4yNTEyIDQyLjcyNjEgMjQuODA1MiA0MS43NDI1IDI1Ljc5TDM2Ljc5IDMwLjc0MjVDMzUuODA1MiAzMS43MjYxIDM1LjI1MTIgMzMuMDYwNiAzNS4yNSAzNC40NTI1VjUwLjVDMzUuMjUgNTEuODkyNCAzNS44MDMxIDUzLjIyNzcgMzYuNzg3NyA1NC4yMTIzQzM3Ljc3MjMgNTUuMTk2OSAzOS4xMDc2IDU1Ljc1IDQwLjUgNTUuNzVINjEuNUM2Mi44OTI0IDU1Ljc1IDY0LjIyNzcgNTUuMTk2OSA2NS4yMTIzIDU0LjIxMjNDNjYuMTk2OSA1My4yMjc3IDY2Ljc1IDUxLjg5MjQgNjYuNzUgNTAuNVYzNC40NTI1QzY2Ljc0ODggMzMuMDYwNiA2Ni4xOTQ4IDMxLjcyNjEgNjUuMjEgMzAuNzQyNVYzMC43NDI1Wk01MSA0N0M0OS4xNDM1IDQ3IDQ3LjM2MyA0Ni4yNjI1IDQ2LjA1MDMgNDQuOTQ5N0M0NC43Mzc1IDQzLjYzNyA0NCA0MS44NTY1IDQ0IDQwQzQ0IDM5LjUzNTkgNDQuMTg0NCAzOS4wOTA4IDQ0LjUxMjYgMzguNzYyNkM0NC44NDA4IDM4LjQzNDQgNDUuMjg1OSAzOC4yNSA0NS43NSAzOC4yNUM0Ni4yMTQxIDM4LjI1IDQ2LjY1OTIgMzguNDM0NCA0Ni45ODc0IDM4Ljc2MjZDNDcuMzE1NiAzOS4wOTA4IDQ3LjUgMzkuNTM1OSA0Ny41IDQwQzQ3LjUgNDAuOTI4MyA0Ny44Njg3IDQxLjgxODUgNDguNTI1MSA0Mi40NzQ5QzQ5LjE4MTUgNDMuMTMxMyA1MC4wNzE3IDQzLjUgNTEgNDMuNUM1MS45MjgzIDQzLjUgNTIuODE4NSA0My4xMzEzIDUzLjQ3NDkgNDIuNDc0OUM1NC4xMzEzIDQxLjgxODUgNTQuNSA0MC45MjgzIDU0LjUgNDBDNTQuNSAzOS41MzU5IDU0LjY4NDQgMzkuMDkwOCA1NS4wMTI2IDM4Ljc2MjZDNTUuMzQwOCAzOC40MzQ0IDU1Ljc4NTkgMzguMjUgNTYuMjUgMzguMjVDNTYuNzE0MSAzOC4yNSA1Ny4xNTkyIDM4LjQzNDQgNTcuNDg3NCAzOC43NjI2QzU3LjgxNTYgMzkuMDkwOCA1OCAzOS41MzU5IDU4IDQwQzU4IDQxLjg1NjUgNTcuMjYyNSA0My42MzcgNTUuOTQ5NyA0NC45NDk3QzU0LjYzNyA0Ni4yNjI1IDUyLjg1NjUgNDcgNTEgNDdaTTQxLjIxNzUgMzEuMjVMNDQuMjEgMjguMjU3NUM0NC41NDU0IDI3LjkzNzcgNDQuOTg5MiAyNy43NTY0IDQ1LjQ1MjUgMjcuNzVINTYuNTQ3NUM1Ny4wMTA4IDI3Ljc1NjQgNTcuNDU0NiAyNy45Mzc3IDU3Ljc5IDI4LjI1NzVMNjAuNzgyNSAzMS4yNUg0MS4yMTc1WiIgZmlsbD0id2hpdGUiLz4KPC9nPgo8L2c+CjxkZWZzPgo8ZmlsdGVyIGlkPSJmaWx0ZXIwX2RfMl8yMCIgeD0iMCIgeT0iMCIgd2lkdGg9Ijk2IiBoZWlnaHQ9Ijk2IiBmaWx0ZXJVbml0cz0idXNlclNwYWNlT25Vc2UiIGNvbG9yLWludGVycG9sYXRpb24tZmlsdGVycz0ic1JHQiI+CjxmZUZsb29kIGZsb29kLW9wYWNpdHk9IjAiIHJlc3VsdD0iQmFja2dyb3VuZEltYWdlRml4Ii8+CjxmZUNvbG9yTWF0cml4IGluPSJTb3VyY2VBbHBoYSIgdHlwZT0ibWF0cml4IiB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDEyNyAwIiByZXN1bHQ9ImhhcmRBbHBoYSIvPgo8ZmVPZmZzZXQgZHk9IjgiLz4KPGZlR2F1c3NpYW5CbHVyIHN0ZERldmlhdGlvbj0iOCIvPgo8ZmVDb21wb3NpdGUgaW4yPSJoYXJkQWxwaGEiIG9wZXJhdG9yPSJvdXQiLz4KPGZlQ29sb3JNYXRyaXggdHlwZT0ibWF0cml4IiB2YWx1ZXM9IjAgMCAwIDAgMC4xNTI5NDEgMCAwIDAgMCAwLjE1Mjk0MSAwIDAgMCAwIDAuMTUyOTQxIDAgMCAwIDAuMTYgMCIvPgo8ZmVCbGVuZCBtb2RlPSJub3JtYWwiIGluMj0iQmFja2dyb3VuZEltYWdlRml4IiByZXN1bHQ9ImVmZmVjdDFfZHJvcFNoYWRvd18yXzIwIi8+CjxmZUJsZW5kIG1vZGU9Im5vcm1hbCIgaW49IlNvdXJjZUdyYXBoaWMiIGluMj0iZWZmZWN0MV9kcm9wU2hhZG93XzJfMjAiIHJlc3VsdD0ic2hhcGUiLz4KPC9maWx0ZXI+CjxmaWx0ZXIgaWQ9ImZpbHRlcjFfZGlfMl8yMCIgeD0iMzEuMjUiIHk9IjIyLjI1IiB3aWR0aD0iMzkuNSIgaGVpZ2h0PSI0MS41IiBmaWx0ZXJVbml0cz0idXNlclNwYWNlT25Vc2UiIGNvbG9yLWludGVycG9sYXRpb24tZmlsdGVycz0ic1JHQiI+CjxmZUZsb29kIGZsb29kLW9wYWNpdHk9IjAiIHJlc3VsdD0iQmFja2dyb3VuZEltYWdlRml4Ii8+CjxmZUNvbG9yTWF0cml4IGluPSJTb3VyY2VBbHBoYSIgdHlwZT0ibWF0cml4IiB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDEyNyAwIiByZXN1bHQ9ImhhcmRBbHBoYSIvPgo8ZmVPZmZzZXQgZHk9IjQiLz4KPGZlR2F1c3NpYW5CbHVyIHN0ZERldmlhdGlvbj0iMiIvPgo8ZmVDb21wb3NpdGUgaW4yPSJoYXJkQWxwaGEiIG9wZXJhdG9yPSJvdXQiLz4KPGZlQ29sb3JNYXRyaXggdHlwZT0ibWF0cml4IiB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAuMjUgMCIvPgo8ZmVCbGVuZCBtb2RlPSJub3JtYWwiIGluMj0iQmFja2dyb3VuZEltYWdlRml4IiByZXN1bHQ9ImVmZmVjdDFfZHJvcFNoYWRvd18yXzIwIi8+CjxmZUJsZW5kIG1vZGU9Im5vcm1hbCIgaW49IlNvdXJjZUdyYXBoaWMiIGluMj0iZWZmZWN0MV9kcm9wU2hhZG93XzJfMjAiIHJlc3VsdD0ic2hhcGUiLz4KPGZlQ29sb3JNYXRyaXggaW49IlNvdXJjZUFscGhhIiB0eXBlPSJtYXRyaXgiIHZhbHVlcz0iMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMTI3IDAiIHJlc3VsdD0iaGFyZEFscGhhIi8+CjxmZU9mZnNldCBkeT0iLTIiLz4KPGZlR2F1c3NpYW5CbHVyIHN0ZERldmlhdGlvbj0iMiIvPgo8ZmVDb21wb3NpdGUgaW4yPSJoYXJkQWxwaGEiIG9wZXJhdG9yPSJhcml0aG1ldGljIiBrMj0iLTEiIGszPSIxIi8+CjxmZUNvbG9yTWF0cml4IHR5cGU9Im1hdHJpeCIgdmFsdWVzPSIwIDAgMCAwIDAuNDU5NjIzIDAgMCAwIDAgMC43NzIyOTQgMCAwIDAgMCAwLjk5ODcxIDAgMCAwIDEgMCIvPgo8ZmVCbGVuZCBtb2RlPSJub3JtYWwiIGluMj0ic2hhcGUiIHJlc3VsdD0iZWZmZWN0Ml9pbm5lclNoYWRvd18yXzIwIi8+CjwvZmlsdGVyPgo8cmFkaWFsR3JhZGllbnQgaWQ9InBhaW50MF9yYWRpYWxfMl8yMCIgY3g9IjAiIGN5PSIwIiByPSIxIiBncmFkaWVudFVuaXRzPSJ1c2VyU3BhY2VPblVzZSIgZ3JhZGllbnRUcmFuc2Zvcm09InRyYW5zbGF0ZSg3MiA2Mykgcm90YXRlKDc0LjYxMTUpIHNjYWxlKDU2LjUyNjUpIj4KPHN0b3Agc3RvcC1jb2xvcj0iI0FFRTdGRiIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiMxNDcyRkUiLz4KPC9yYWRpYWxHcmFkaWVudD4KPC9kZWZzPgo8L3N2Zz4K"
imgBtn.src = iconBase64;
imgBtn.alt = "On screen button image"
imgBtn.setAttribute('id', 'imgBtn');

// Popup stuffs
var popupDiv = document.createElement('div'); // <div popup>
popupDiv.setAttribute('id', 'popup');
var popupContent = document.createElement('div'); // <div popup-content>
popupContent.setAttribute('class', 'popup-content');
var closeBtn = document.createElement('span'); // <span close>
closeBtn.setAttribute('class', 'close');
closeBtn.addEventListener("click", ()=> {popupDiv.style.display = "none";});
var iconClose = document.createElement('img'); // <img>
var iconCloseBase64 = "data:image/svg+xml;charset=utf-8;base64,PHN2ZyB3aWR0aD0iMTIiIGhlaWdodD0iMTIiIHZpZXdCb3g9IjAgMCAxMiAxMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTYuNzgzMzUgNkwxMS4zODg5IDEuMzk0NDRDMTEuNDc5OSAxLjI4ODE2IDExLjUyNzUgMS4xNTE0NSAxMS41MjIxIDEuMDExNjNDMTEuNTE2NyAwLjg3MTgxNSAxMS40NTg3IDAuNzM5MTgyIDExLjM1OTggMC42NDAyNDFDMTEuMjYwOCAwLjU0MTI5OSAxMS4xMjgyIDAuNDgzMzM3IDEwLjk4ODQgMC40Nzc5MzZDMTAuODQ4NiAwLjQ3MjUzNSAxMC43MTE4IDAuNTIwMDk0IDEwLjYwNTYgMC42MTExMDlMNi4wMDAwMSA1LjIxNjY2TDEuMzk0NDYgMC42MDU1NTNDMS4yODk4NCAwLjUwMDk0IDEuMTQ3OTYgMC40NDIxNjkgMS4wMDAwMSAwLjQ0MjE2OUMwLjg1MjA2NyAwLjQ0MjE2OSAwLjcxMDE4MSAwLjUwMDk0IDAuNjA1NTY4IDAuNjA1NTUzQzAuNTAwOTU1IDAuNzEwMTY3IDAuNDQyMTgzIDAuODUyMDUzIDAuNDQyMTgzIDAuOTk5OTk4QzAuNDQyMTgzIDEuMTQ3OTQgMC41MDA5NTUgMS4yODk4MyAwLjYwNTU2OCAxLjM5NDQ0TDUuMjE2NjggNkwwLjYwNTU2OCAxMC42MDU2QzAuNTQ3NDExIDEwLjY1NTQgMC41MDAxNzggMTAuNzE2NiAwLjQ2NjgzMSAxMC43ODU2QzAuNDMzNDg1IDEwLjg1NDUgMC40MTQ3NDYgMTAuOTI5NiAwLjQxMTc5MSAxMS4wMDYxQzAuNDA4ODM2IDExLjA4MjYgMC40MjE3MjggMTEuMTU4OSAwLjQ0OTY1OCAxMS4yMzAyQzAuNDc3NTg4IDExLjMwMTUgMC41MTk5NTQgMTEuMzY2MiAwLjU3NDA5NSAxMS40MjA0QzAuNjI4MjM3IDExLjQ3NDUgMC42OTI5ODUgMTEuNTE2OSAwLjc2NDI3NyAxMS41NDQ4QzAuODM1NTY5IDExLjU3MjcgMC45MTE4NjUgMTEuNTg1NiAwLjk4ODM3NSAxMS41ODI3QzEuMDY0ODkgMTEuNTc5NyAxLjEzOTk2IDExLjU2MSAxLjIwODg4IDExLjUyNzZDMS4yNzc4MSAxMS40OTQzIDEuMzM5MSAxMS40NDcgMS4zODg5IDExLjM4ODlMNi4wMDAwMSA2Ljc4MzMzTDEwLjYwNTYgMTEuMzg4OUMxMC43MTE4IDExLjQ3OTkgMTAuODQ4NiAxMS41Mjc1IDEwLjk4ODQgMTEuNTIyMUMxMS4xMjgyIDExLjUxNjcgMTEuMjYwOCAxMS40NTg3IDExLjM1OTggMTEuMzU5OEMxMS40NTg3IDExLjI2MDggMTEuNTE2NyAxMS4xMjgyIDExLjUyMjEgMTAuOTg4NEMxMS41Mjc1IDEwLjg0ODUgMTEuNDc5OSAxMC43MTE4IDExLjM4ODkgMTAuNjA1Nkw2Ljc4MzM1IDZaIiBmaWxsPSJibGFjayIvPgo8L3N2Zz4K";
iconClose.src = iconCloseBase64;
iconClose.alt = "Close button image";
closeBtn.appendChild(iconClose);
popupContent.appendChild(closeBtn);
var title = document.createElement('h4'); // <h4>
title.textContent = "dummy Title lakflsk lkj slf lkjlkj;j lkj lkjsf l;kj ;jk";
popupContent.appendChild(title);
popupDiv.appendChild(popupContent);

document.body.appendChild(popupDiv);

// ----------------
// Listener for the floating button
imgBtn.addEventListener("click", receivedMessageDOM)
document.body.appendChild(imgBtn);

window.onclick = function(event) {
    var popup = document.getElementById('popup');
    if (event.target == popup) {
        popup.style.display = "none";
    }
}


// -----------------------------------
// Listener for background
chrome.runtime.onMessage.addListener(receivedMessageBG);

// Floating
function receivedMessageDOM (){
    // send msg to background?
    // trigger API call
    // modify DOM
    var popup = document.getElementById('popup');
    popup.style.display = "block";

    let domMsg = {
        txt: "dom msg"
    };

    // chrome.runtime.sendMessage(domMsg, async function(response) {
    //     console.log(response);
    //  });
    console.log("clicking floating button...")
}

// Floating closes
function closePopup () {
    var popup = document.getElementById('popup');
    popup.style.display = "none";
}

// Top
function receivedMessageBG (message, sender, sendResponse) {
    // send msg to background?
    // trigger API call
    // modify DOM
    let title = document.querySelector('h1').textContent.trim();
    // window.location.href --> amazon or not --> id='title'
    console.log(title);
    console.log(message.txt);
};

